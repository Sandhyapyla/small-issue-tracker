<div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin:12px 0;">
  <mat-form-field appearance="outline" style="flex:1 1 220px; min-width:200px;">
    <mat-label>Search title</mat-label>
    <input matInput placeholder="e.g. export" [(ngModel)]="search" (keyup.enter)="page=1; fetch()"/>
  </mat-form-field>

  <mat-form-field appearance="outline" style="width:160px;">
    <mat-label>Status</mat-label>
    <mat-select [(ngModel)]="status" (selectionChange)="page=1; fetch()">
      <mat-option [value]="''">All</mat-option>
      <mat-option *ngFor="let s of statuses" [value]="s">{{s}}</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline" style="width:160px;">
    <mat-label>Priority</mat-label>
    <mat-select [(ngModel)]="priority" (selectionChange)="page=1; fetch()">
      <mat-option [value]="''">All</mat-option>
      <mat-option *ngFor="let p of priorities" [value]="p">{{p}}</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline" style="width:180px;">
    <mat-label>Assignee</mat-label>
    <input matInput [(ngModel)]="assignee" (keyup.enter)="page=1; fetch()"/>
  </mat-form-field>

  <button mat-stroked-button color="primary" (click)="fetch()">Apply</button>
  <button mat-button (click)="resetFilters()">Reset</button>
  <span class="toolbar-spacer"></span>
  <button mat-raised-button color="accent" (click)="openCreate()">
    <mat-icon>add</mat-icon>
    Create Issue
  </button>
</div>

<mat-card>
  <div style="overflow:auto;">
    <table mat-table [dataSource]="items" class="mat-elevation-z1" style="width:100%; min-width:800px;">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef (click)="onSort('id')">ID</th>
        <td mat-cell *matCellDef="let row" (click)="openDetail(row)">{{row.id}}</td>
      </ng-container>

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef (click)="onSort('title')">Title</th>
        <td mat-cell *matCellDef="let row" (click)="openDetail(row)">{{row.title}}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef (click)="onSort('status')">Status</th>
        <td mat-cell *matCellDef="let row" (click)="openDetail(row)">{{row.status}}</td>
      </ng-container>

      <ng-container matColumnDef="priority">
        <th mat-header-cell *matHeaderCellDef (click)="onSort('priority')">Priority</th>
        <td mat-cell *matCellDef="let row" (click)="openDetail(row)">{{row.priority}}</td>
      </ng-container>

      <ng-container matColumnDef="assignee">
        <th mat-header-cell *matHeaderCellDef (click)="onSort('assignee')">Assignee</th>
        <td mat-cell *matCellDef="let row" (click)="openDetail(row)">{{row.assignee || '-'}}
        </td>
      </ng-container>

      <ng-container matColumnDef="updatedAt">
        <th mat-header-cell *matHeaderCellDef (click)="onSort('updatedAt')">Updated</th>
        <td mat-cell *matCellDef="let row" (click)="openDetail(row)">{{row.updatedAt | date:'short'}}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let row">
          <button mat-button color="primary" (click)="openEdit(row, $event)">Edit</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['id','title','status','priority','assignee','updatedAt','actions']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['id','title','status','priority','assignee','updatedAt','actions'];"></tr>
    </table>
  </div>

  <div style="display:flex; align-items:center; gap:12px; padding:8px 0; flex-wrap:wrap;">
    <button mat-stroked-button (click)="onPageChange(-1)" [disabled]="page<=1">Prev</button>
    <span>Page {{page}} / {{ maxPage }}</span>
    <button mat-stroked-button (click)="onPageChange(1)" [disabled]="page >= maxPage">Next</button>

    <mat-form-field appearance="outline" style="width:100px;">
      <mat-label>Page size</mat-label>
      <mat-select [(ngModel)]="pageSize" (selectionChange)="onPageSizeChange()">
        <mat-option [value]="5">5</mat-option>
        <mat-option [value]="10">10</mat-option>
        <mat-option [value]="20">20</mat-option>
        <mat-option [value]="50">50</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</mat-card>
